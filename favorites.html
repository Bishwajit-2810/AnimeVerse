<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Favorites ‚Äî AnimeVerse</title>

    <link rel="stylesheet" href="assets/css/reset.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <!-- HEADER -->
    <div class="header-wrap">
      <header class="header container">
        <div style="display: flex; align-items: center; gap: 12px">
          <button id="mobile-nav-toggle" class="mobile-nav-toggle">‚ò∞</button>

          <a
            href="index.html"
            class="brand"
            style="text-decoration: none; color: inherit"
          >
            <span class="logo"></span> AnimeVerse
          </a>
        </div>

        <nav class="nav" id="main-nav">
          <a href="index.html">Home</a>
          <a href="trending.html">Trending</a>
          <a href="genres.html">Genres</a>
          <a href="favorites.html" class="active">Favorites</a>
          <a href="about.html">About</a>
        </nav>

        <div style="display: flex; align-items: center; gap: 10px">
          <div class="search-wrap">
            <button id="search-open" class="search-toggle">üîç</button>
            <input
              id="nav-search-input"
              class="search-input"
              type="search"
              placeholder="Search anime (press S)..."
            />
            <button id="voice-btn" class="search-toggle">üé§</button>
            <div id="suggestions" class="suggestions"></div>
          </div>

          <div class="controls">
            <button
              id="theme-toggle"
              onclick="animeverseToggleTheme()"
              class="pill"
            >
              üåì
            </button>
          </div>
        </div>
      </header>
    </div>

    <!-- PAGE CONTENT -->
    <main class="page container">
      <h1>Your Favorites</h1>

      <!-- NEW: Export / Import buttons -->
      <div class="fav-actions" style="margin: 12px 0; display: flex; gap: 10px">
        <button class="btn secondary" onclick="exportFavorites()">
          ‚¨áÔ∏è Export JSON
        </button>

        <label class="btn secondary" style="cursor: pointer">
          ‚¨ÜÔ∏è Import JSON
          <input
            type="file"
            accept="application/json"
            onchange="importFavorites(event)"
            style="display: none"
          />
        </label>
      </div>

      <div id="favorites-grid" class="card-grid" style="margin-top: 20px"></div>
      <div id="fav-msg" style="color: var(--muted); margin-top: 14px"></div>
    </main>

    <footer class="footer container">
      <p style="color: var(--muted)">¬© AnimeVerse</p>
    </footer>

    <!-- SCRIPTS -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
      /* Hook into app.js */

      async function renderFavorites() {
        const grid = document.getElementById("favorites-grid");
        const msg = document.getElementById("fav-msg");

        const favs = getFavorites();

        if (!favs.length) {
          grid.innerHTML = "";
          msg.textContent = "No favorites added yet.";
          return;
        }

        msg.textContent = "Loading your favorites‚Ä¶";

        const details = await Promise.all(
          favs.map((id) => fetchAnimeBasic(id).catch(() => null))
        );

        const items = details.filter(Boolean);
        msg.textContent = "";

        grid.innerHTML = items
          .map(
            (it) => `
          <div class="fav-card">
            <a href="anime.html?id=${it.mal_id}" class="fav-link">
              <img src="${it.images?.jpg?.image_url}" class="poster" />
              <div class="card-title">${esc(it.title)}</div>
              <div class="card-meta">‚≠ê ${it.score || "N/A"}</div>
            </a>

            <button class="remove-btn" onclick="removeFavorite(${it.mal_id})">
              ‚úñ
            </button>
          </div>
        `
          )
          .join("");
      }

      function removeFavorite(id) {
        const updated = getFavorites().filter((x) => x !== id);
        localStorage.setItem("favs", JSON.stringify(updated));
        renderFavorites();
      }

      renderFavorites();
    </script>
  </body>
</html>
