<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Anime Details â€” AnimeVerse</title>

    <link rel="stylesheet" href="assets/css/reset.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <!-- HEADER -->
    <div class="header-wrap">
      <header class="header container">
        <div style="display: flex; align-items: center; gap: 12px">
          <div class="brand"><span class="logo"></span> AnimeVerse</div>
        </div>

        <nav class="nav">
          <a href="index.html">Home</a>
          <a href="trending.html">Trending</a>
          <a href="genres.html">Genres</a>
          <a href="favorites.html">Favorites</a>
          <a href="about.html">About</a>
        </nav>

        <div style="display: flex; align-items: center; gap: 10px">
          <div class="search-wrap">
            <button id="search-open" class="search-toggle">ğŸ”</button>
            <input
              id="nav-search-input"
              class="search-input"
              type="search"
              placeholder="Search animeâ€¦"
            />
            <button id="voice-btn" class="search-toggle">ğŸ¤</button>
            <div id="suggestions" class="suggestions"></div>
          </div>

          <div class="controls">
            <button
              onclick="animeverseToggleTheme()"
              class="pill"
              style="
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.05);
                padding: 8px;
                border-radius: 10px;
              "
            >
              ğŸŒ“
            </button>
          </div>
        </div>
      </header>
    </div>

    <!-- PAGE CONTENT -->
    <main class="page container" id="content">
      <div style="padding: 40px; color: var(--muted)">Loadingâ€¦</div>
    </main>

    <footer class="footer container">
      <p style="color: var(--muted)">Â© AnimeVerse</p>
    </footer>

    <!-- scripts -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
      (async () => {
        const id = new URLSearchParams(location.search).get("id");
        const root = document.getElementById("content");

        if (!id) {
          root.innerHTML = "<p>Missing anime ID.</p>";
          return;
        }

        const data = await fetchAnimeDetails(id);
        if (!data) {
          root.innerHTML = "<p>Anime not found.</p>";
          return;
        }

        const img = data.images?.jpg?.large_image_url;
        const title = data.title;
        const score = data.score || "N/A";
        const episodes = data.episodes || "â€”";
        const synopsis = data.synopsis || "No synopsis available.";

        function renderFavBtn() {
          const added = isFavorite(data.mal_id);
          return `
            <button id="fav-btn"
                    class="btn ${added ? "favorite-active" : ""}"
                    style="margin-top:14px;width:100%">
              ${
                added
                  ? "â¤ï¸ Added to Favorites (click to remove)"
                  : "ğŸ¤ Add to Favorites"
              }
            </button>`;
        }

        /* Inject the layout */
        root.innerHTML = `
          <div class="anime-details-grid">
            
            <div>
              <img src="${img}" class="poster-lg"/>

              <div class="details-buttons">
                ${renderFavBtn()}
                <a class="btn secondary"
                   href="https://myanimelist.net/anime/${data.mal_id}"
                   target="_blank">
                   View on MAL
                </a>
              </div>
            </div>

            <div class="anime-details-text">
  <h1>${esc(title)}</h1>

  <div class="meta-block">
    â­ <b>${score}</b>  
    â€¢ Episodes: ${episodes}  
    â€¢ Type: ${data.type || "â€”"}  
    â€¢ Status: ${data.status || "â€”"}  
  </div>

  <div class="meta-list">

    <div><b>Japanese:</b> ${esc(data.title_japanese || "â€”")}</div>
    <div><b>English:</b> ${esc(data.title_english || "â€”")}</div>

    <div><b>Season:</b> ${
      data.season ? data.season + " " + data.year : "â€”"
    }</div>

    <div><b>Duration:</b> ${data.duration || "â€”"}</div>
    <div><b>Rating:</b> ${data.rating || "â€”"}</div>

    <div><b>Studios:</b> 
      ${data.studios?.map((s) => esc(s.name)).join(", ") || "â€”"}
    </div>

    <div><b>Producers:</b> 
      ${data.producers?.map((p) => esc(p.name)).join(", ") || "â€”"}
    </div>

    <div><b>Genres:</b> 
      ${data.genres?.map((g) => esc(g.name)).join(", ") || "â€”"}
    </div>

    <div><b>Rank:</b> ${data.rank || "â€”"}</div>
    <div><b>Popularity:</b> ${data.popularity || "â€”"}</div>
    <div><b>Favorites:</b> ${data.favorites || "â€”"}</div>
  </div>

  <h3 style="margin-top:20px">Synopsis</h3>
  <p style="color:var(--muted);line-height:1.6;margin-top:6px">
    ${esc(synopsis)}
  </p>

  ${
    data.trailer?.url
      ? `
    <div class="trailer-box">
      <h3>Trailer</h3>
      <iframe src="${data.trailer.embed_url}" 
              class="trailer-frame"
              allowfullscreen></iframe>
    </div>`
      : ""
  }
</div>


          </div>
        `;

        /* Button toggle handler */
        const favBtn = document.getElementById("fav-btn");

        favBtn.onclick = () => {
          const added = toggleFavorite(data.mal_id);

          if (added) {
            favBtn.textContent = "â¤ï¸ Added to Favorites (click to remove)";
            favBtn.classList.add("favorite-active");
          } else {
            favBtn.textContent = "ğŸ¤ Add to Favorites";
            favBtn.classList.remove("favorite-active");
          }
        };
      })();
    </script>
  </body>
</html>
